# REUSE Compliance Check for {{ cookiecutter.project_name }}
# Validates REUSE 3.0 specification compliance for license management
#
# REUSE helps with clear licensing by using SPDX headers
# Documentation: https://reuse.software/

{%- if cookiecutter.use_reuse_licensing == "yes" and cookiecutter.include_github_actions == "yes" %}
name: REUSE Compliance

on:
  pull_request:
    paths:
      - "**/*"
      - "REUSE.toml"
      - "LICENSES/**"
      - ".github/workflows/reuse.yml"
  push:
    branches:
      - main
      - master
      - develop

permissions: read-all

jobs:
  reuse:
    name: Check REUSE Compliance
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2

      - name: REUSE Compliance Check
        uses: fsfe/reuse-action@3ae3c6bdf1257ab19397fab11fd3312144692083 # v4.0.0

      - name: Generate REUSE SPDX
        if: success()
        run: |
          docker run --rm --volume $(pwd):/data fsfe/reuse:latest spdx --output /data/reuse-spdx.json

      - name: Upload REUSE SPDX
        if: success()
        uses: actions/upload-artifact@6f51ac03b9356f520e9adb1b1b7802705f340c2b # v4.5.0
        with:
          name: reuse-spdx
          path: reuse-spdx.json
          retention-days: 90

  validate-licenses:
    name: Validate License Files
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2

      - name: Check primary license exists
        run: |
          if [ ! -f "LICENSES/{{ cookiecutter.license }}.txt" ]; then
            echo "Warning: {{ cookiecutter.license }}.txt not found in LICENSES/"
            echo "You may need to download it from https://spdx.org/licenses/"
          fi

      - name: Verify REUSE.toml exists
        run: |
          if [ ! -f "REUSE.toml" ]; then
            echo "Error: REUSE.toml missing from repository root"
            exit 1
          fi
{%- else %}
# REUSE licensing disabled for this project
# Enable use_reuse_licensing and include_github_actions to use REUSE compliance checks
{%- endif %}
