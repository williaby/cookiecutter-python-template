# Mutation Testing for {{ cookiecutter.project_name }}
# Validates test effectiveness by introducing code mutations.
#
# This is a thin caller to the org-level reusable workflow.
#
# Documentation: https://mutmut.readthedocs.io/
{%- if cookiecutter.include_github_actions == "yes" %}
name: Mutation Testing

on:
  # Weekly schedule - Sundays at 2 AM UTC
  schedule:
    - cron: '0 2 * * 0'
  # Manual trigger with configurable threshold
  workflow_dispatch:
    inputs:
      mutation_threshold:
        description: 'Minimum mutation score threshold (%)'
        required: false
        default: '80'
        type: string
  # Run on PRs that modify source code
  pull_request:
    branches: [main, master, develop]
    paths:
      - 'src/**/*.py'
      - 'tests/**/*.py'
      - 'pyproject.toml'

# Cancel in-progress runs for same PR/branch
concurrency:
  group: {% raw %}mutation-${{ github.event.pull_request.number || github.ref }}{% endraw %}
  cancel-in-progress: true

permissions:
  contents: read
  pull-requests: write

jobs:
  mutation:
    name: Mutation Testing
    # Skip on forks (no PR comment permissions)
    if: github.event_name != 'pull_request' || github.event.pull_request.head.repo.full_name == github.repository
    uses: {{ cookiecutter.github_org_or_user }}/.github/.github/workflows/python-mutation.yml@main
    with:
      python-version: '{{ cookiecutter.python_version }}'
      source-directory: 'src'
      test-directory: 'tests'
      mutation-threshold: {% raw %}${{ github.event.inputs.mutation_threshold && fromJSON(github.event.inputs.mutation_threshold) || 80 }}{% endraw %}
      fail-under-threshold: {% raw %}${{ github.event_name != 'schedule' }}{% endraw %}
      post-pr-comment: true
      timeout-minutes: 60
    secrets: inherit
{%- else %}
# GitHub Actions disabled for this project
# Enable include_github_actions to use mutation testing
name: Mutation Testing (Disabled)

on:
  workflow_dispatch:

permissions: read-all

jobs:
  info:
    name: Mutation Testing Disabled
    runs-on: ubuntu-latest
    steps:
      - name: Info
        run: |
          echo "Mutation testing is disabled for this project."
          echo "To enable, set include_github_actions to 'yes' in cookiecutter.json"
{%- endif %}
