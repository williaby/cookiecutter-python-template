# Security Analysis - Calls Org-Level Reusable Workflow
# This is a lightweight caller workflow that invokes the organization's
# shared Python security analysis workflow with CodeQL, Bandit, Safety, and OSV.
name: Security Analysis

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  schedule:
    # Run security scans weekly on Monday at 9 AM UTC
    - cron: '0 9 * * 1'
  workflow_dispatch:

# Cancel in-progress runs for same PR/branch
concurrency:
  group: {% raw %}${{ github.workflow }}-${{ github.event.pull_request.number || github.ref }}{% endraw %}
  cancel-in-progress: true

jobs:
  security:
    name: Security Scan
    uses: {{ cookiecutter.github_org_or_user }}/.github/.github/workflows/python-security-analysis.yml@main
    with:
      source-directory: 'src'
      python-version: '{{ cookiecutter.python_version }}'

      # Fail settings
      fail-on-high: true
      fail-on-medium: false

      # Enable all security tools
      run-codeql: true
      run-dependency-review: true
      run-bandit: true
      run-safety: true
      run-osv: true

permissions:
  contents: read
  security-events: write
  pull-requests: write
